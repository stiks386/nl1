/*! Thrive Architect - 2022-01-25
* http://www.thrivethemes.com/
* Copyright (c) 2022 Thrive Themes */

"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(r,s.key,s)}}function _createClass(r,e,t){return e&&_defineProperties(r.prototype,e),t&&_defineProperties(r,t),r}function _defineProperty(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _typeof(r){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}!function(l){var d,p,o,h,m,i={".js":[],".json":[],".css":[],".html":[]},u="function"==typeof require?require:null;return h=function(r){var e=new Error("Could not find module '"+r+"'");return e.code="MODULE_NOT_FOUND",e},m=function(r,e,t){var s,o;if("function"==typeof r[e+t])return e+t;for(s=0;o=i[t][s];++s)if("function"==typeof r[e+o])return e+o;return null},d=function(r,e,t,s,o,i){var n,a,l,u,c,f;for("."!==(n=(t=t.split("/")).pop())&&".."!==n||(t.push(n),n="");null!=(a=t.shift());)if(a&&"."!==a&&(".."===a?(r=e.pop(),i=i.slice(0,i.lastIndexOf("/"))):(e.push(r),r=r[a],i+="/"+a),!r))throw h(s);if(n&&"function"!=typeof r[n]&&((f=(f=(f=(f=m(r,n,".js"))||m(r,n,".json"))||m(r,n,".css"))||m(r,n,".html"))?n=f:2!==o&&"object"===_typeof(r[n])&&(e.push(r),r=r[n],i+="/"+n,n="")),!n)return 1!==o&&r[":mainpath:"]?d(r,e,r[":mainpath:"],s,1,i):d(r,e,"index",s,2,i);if(!(c=r[n]))throw h(s);return c.hasOwnProperty("module")?c.module.exports:(l={},c.module=u={exports:l,id:i+"/"+n},c.call(l,l,u,p(r,e,i)),u.exports)},o=function(r,e,t,s){var o,i=t,n=t.charAt(0),a=0;if("/"===n){if(i=i.slice(1),!(r=l["/"])){if(u)return u(t);throw h(t)}s="/",e=[]}else if("."!==n){if(o=i.split("/",1)[0],!(r=l[o])){if(u)return u(t);throw h(t)}s=o,e=[],(i=i.slice(o.length+1))||(a=(i=r[":mainpath:"])?1:(i="index",2))}return d(r,e,i,t,a,s)},(p=function(e,t,s){return function(r){return o(e,[].concat(t),r,s)}})(l,[],"")}({workspace:{editor:{js:{frontend:{modules:{"user-profile.js":function(r,e,t){void 0===TCB_Front.js_modules["user-profile"]&&TCB_Front.setModuleLoadedStatus("user-profile",!1),function(o,i){if(!TCB_Front.isModuleLoaded("user-profile")){var r=["nickname","username","first_name","last_name"],t=function(){function e(r){_classCallCheck(this,e),_defineProperty(this,"usedDisplayNames",[]),_defineProperty(this,"$errorContainer",o()),_defineProperty(this,"inputErrorClass","tve-up-error"),_defineProperty(this,"isValid",!0),r.hasClass("tve-user-profile")||(r=r.find(".tve-user-profile")),r.length&&!r.data("tcb.userprofile")&&(this.$el=r,this.$form=this.$el.find("form"),this.readFormData(),this.bindEvents(),this.autofillData(),r.data("tcb.userprofile",this))}return _createClass(e,[{key:"readFormData",value:function(){var s=this;this.getInputs().each(function(r,e){var t=e.getAttribute("name");t&&(s["$".concat(t)]=o(e),"display_name"===t&&(s.$dropdown=s.$form.find(".tve-lg-dropdown-list"),s.$option=s.$dropdown.children().first(),s.$dropdown.empty()))});var r={success_message:"Success",error_message:{email:"Email address invalid",required:"Required field missing",passwordmismatch:"Password mismatch"}};try{r=JSON.parse(this.$el.find(".tve-up-messages").val())}catch(r){}Object.assign(this,r)}},{key:"bindEvents",value:function(){var e=this;this.$form.on("submit",function(r){return e.submitForm(r),r.preventDefault(),r.stopPropagation(),!1}),this.$form.find(".tve-form-button .tve-form-button-submit").on("click",function(r){return r.preventDefault(),r.stopPropagation(),e.$form.submit(),!1}),this.$display_name&&r.forEach(function(r){e["$".concat(r)]&&e["$".concat(r)].on("blur",function(){e.buildDisplayNameOptions()})})}},{key:"validateForm",value:function(){var i=this;this.fieldErrors=[],this.isValid=!0,this.getInputs().each(function(r,e){var t=!0,s=e.getAttribute("name"),o=e.value.trim();"1"!==e.dataset.required||o.length||(t=!1,i.fieldErrors.includes(i.error_message.required)||i.fieldErrors.push(i.error_message.required)),"user_email"===s&&((t=TCB_Front.Utils.isEmail(o))||i.fieldErrors.push(i.error_message.email)),t||(e.classList.add(i.inputErrorClass),i.isValid=!1)}),this.$pass1&&(this.$pass1.siblings(".tve-password-strength-wrapper").attr("data-score")<=30&&(this.fieldErrors.push(this.error_message.password_score||"Please choose a stronger password. Try including numbers, symbols, and a mix of upper and lowercase letters and remove common words."),this.isValid=!1),this.$pass2&&this.$pass1.val()!==this.$pass2.val()&&(this.$pass1.addClass(this.inputErrorClass),this.$pass2.addClass(this.inputErrorClass),this.fieldErrors.push(this.error_message.passwordmismatch),this.isValid=!1))}},{key:"submitForm",value:function(){var t=this;if(this.clearErrors(),this.validateForm(),this.isValid){var r="".concat(this.$form.serialize(),"&action=tve_user_profile_update&url=").concat(encodeURIComponent(location.href));r+="&form_id=".concat(this.$el.attr("id")),this.$form.tve_form_loading(),tve_frontend_options.post_id&&(r+="&post_id=".concat(tve_frontend_options.post_id)),ThriveGlobal.$j.ajax({type:"post",xhrFields:{withCredentials:!0},url:tve_frontend_options.ajaxurl,dataType:"json",data:r}).fail(function(){TCB_Front.Utils.toast("An error occurred while submitting your data. Please try again",!0)}).done(function(r){if(r.success)TCB_Front.Utils.toast(t.success_message);else if(t.fieldErrors=[],"string"==typeof r.errors)TCB_Front.Utils.toast(r.errors,!0);else{var e=r.errors.errors;Object.keys(e).forEach(function(r){t.error_message[r]?t.fieldErrors.push(t.error_message[r]):e[r].forEach(function(r){return t.fieldErrors.push(r)})}),t.fieldErrors.length&&t.displayFormError()}}).always(function(){t.$form.tve_form_loading(!0)})}else this.displayFormError()}},{key:"autofillData",value:function(){var e=this;o.isEmptyObject(tve_frontend_options.current_user)||Object.keys(tve_frontend_options.current_user).forEach(function(r){e["$".concat(r)]&&e["$".concat(r)].val(tve_frontend_options.current_user[r])}),this.$display_name&&(this.buildDisplayNameOptions(),this.$dropdown.find('li[data-value="'.concat(tve_frontend_options.current_user.display_name.replace(/"/g,'\\"'),'"]')).trigger("mousedown"))}},{key:"buildDisplayNameOptions",value:function(){var t=this,s={oldSavedValue:tve_frontend_options.current_user.display_name};r.forEach(function(r){t["$".concat(r)]&&(s["".concat(r)]=t["$".concat(r)].val())}),s.first_name&&s.last_name&&(s.first_last="".concat(s.first_name," ").concat(s.last_name),s.last_first="".concat(s.last_name," ").concat(s.first_name)),Object.keys(s).forEach(function(r){if(s[r].trim()&&!t.usedDisplayNames.includes(s[r])){var e=t.$option.clone();e.attr("data-value",s[r]).css("display","").find("span").text(s[r]),t.$dropdown.append(e),t.usedDisplayNames.push(s[r]),i.inlineCssVariable(t.$dropdown,{"--rows":t.$dropdown.children().length})}})}},{key:"displayFormError",value:function(){var t=this;this.$errorContainer.length||(this.$errorContainer=o('<div id="tve-up-error-container"></div>').prependTo(this.$form.parent()),this.$errorContainer.append('<a href="javascript:void(0)" class="tve-up-err-close" title="Close"><span class="thrv-icon thrv-svg-icon">'.concat(TCB_Front.icons.get("cross"),"</span></a>")),this.$errorContainer.on("click",".tve-up-err-close",this.closeErrors.bind(this))),this.fieldErrors.forEach(function(r){o('<div class="tve-up-error-message">'.concat(r,"</div>")).prependTo(t.$errorContainer)}),setTimeout(function(){var r=parseInt(t.$form.css("margin-top")),e=-10-t.$errorContainer.outerHeight(!0)-(isNaN(r)?0:r);t.$el.offset().top+e<0&&(e=0),t.$errorContainer.css({top:"".concat(e,"px"),width:t.$form.outerWidth()}).fadeIn(200)},50)}},{key:"closeErrors",value:function(){var r=this.$form.find(".".concat(this.inputErrorClass)).first();r.length||(r=this.getInputs().first()),r.trigger("focus"),this.clearErrors(!1)}},{key:"clearErrors",value:function(r){var e=!(0<arguments.length&&void 0!==r)||r;this.$errorContainer.find(".tve-up-error-message").remove(),this.$errorContainer.fadeOut(200),e&&this.$form.find(".".concat(this.inputErrorClass)).removeClass(this.inputErrorClass)}},{key:"getInputs",value:function(){return this.$form.find("input,textarea,select").filter(':not([type="hidden"]):visible')}}]),e}();o(window).on("tcb_after_dom_ready",function(){TCB_Front.Utils.isEditorPage()||o(".tve-user-profile").each(function(r,e){return new t(o(e))})}),window.TCB_Front.UserProfile=t,e.exports=t,TCB_Front.setModuleLoadedStatus("user-profile",!0)}}(ThriveGlobal.$j,TCB_Front)}}}}}}})("workspace/editor/js/frontend/modules/user-profile");