/*! Thrive Architect - 2022-01-25
* http://www.thrivethemes.com/
* Copyright (c) 2022 Thrive Themes */

"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(d){var u,f,o,v,h,s={".js":[],".json":[],".css":[],".html":[]},l="function"==typeof require?require:null;return v=function(t){var e=new Error("Could not find module '"+t+"'");return e.code="MODULE_NOT_FOUND",e},h=function(t,e,i){var n,o;if("function"==typeof t[e+i])return e+i;for(n=0;o=s[i][n];++n)if("function"==typeof t[e+o])return e+o;return null},u=function(t,e,i,n,o,s){var a,r,d,l,c,p;for("."!==(a=(i=i.split("/")).pop())&&".."!==a||(i.push(a),a="");null!=(r=i.shift());)if(r&&"."!==r&&(".."===r?(t=e.pop(),s=s.slice(0,s.lastIndexOf("/"))):(e.push(t),t=t[r],s+="/"+r),!t))throw v(n);if(a&&"function"!=typeof t[a]&&((p=(p=(p=(p=h(t,a,".js"))||h(t,a,".json"))||h(t,a,".css"))||h(t,a,".html"))?a=p:2!==o&&"object"===_typeof(t[a])&&(e.push(t),t=t[a],s+="/"+a,a="")),!a)return 1!==o&&t[":mainpath:"]?u(t,e,t[":mainpath:"],n,1,s):u(t,e,"index",n,2,s);if(!(c=t[a]))throw v(n);return c.hasOwnProperty("module")?c.module.exports:(d={},c.module=l={exports:d,id:s+"/"+a},c.call(d,d,l,f(t,e,s)),l.exports)},o=function(t,e,i,n){var o,s=i,a=i.charAt(0),r=0;if("/"===a){if(s=s.slice(1),!(t=d["/"])){if(l)return l(i);throw v(i)}n="/",e=[]}else if("."!==a){if(o=s.split("/",1)[0],!(t=d[o])){if(l)return l(i);throw v(i)}n=o,e=[],(s=s.slice(o.length+1))||(r=(s=t[":mainpath:"])?1:(s="index",2))}return u(t,e,s,i,r,n)},(f=function(e,i,n){return function(t){return o(e,[].concat(i),t,n)}})(d,[],"")}({workspace:{editor:{js:{frontend:{modules:{"conditional-display.js":function(t,e,i){void 0===TCB_Front.js_modules["conditional-display"]&&TCB_Front.setModuleLoadedStatus("conditional-display",!1),function(b,g){if(!TCB_Front.isModuleLoaded("conditional-display")){var t=new(function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"initFrontend",value:function(){this.fetchGroups(),this.buildPreview(),this.bindEvents(),this.initTooltip()}},{key:"initTooltip",value:function(){if(this.isPreviewNeeded()&&!this.shouldHideIcon&&!tve_frontend_options.conditional_display.is_tooltip_dismissed&&0===b(".conditional-tooltip-wrapper").length){b("#wpadminbar").append('<div class="conditional-tooltip-wrapper"><div class="conditional-tooltip-title">Quick tip</div><div class="conditional-tooltip-text">From here you can select which condition you want to preview</div><div class="conditional-tooltip-preview"><div class="conditional-tooltip-preview-text">Currently previewing as:</div><ul class="conditional-tooltip-preview-items"></ul></div><button class="dismiss-conditional-tooltip click">GOT IT</button></div>'),this.addPreviewList(b(".conditional-tooltip-wrapper .conditional-tooltip-preview-items"));var t=b(".conditional-tooltip-wrapper");t.css({top:"40px",left:b(".tve-preview-conditions-icon").offset().left-.88*t.width()}),b(".dismiss-conditional-tooltip").on("click",function(){t.hide(),b.ajax({type:"post",xhrFields:{withCredentials:!0},url:tve_frontend_options.ajaxurl,dataType:"json",data:{action:"dismiss_conditional_tooltip"}}),tve_frontend_options.conditional_display.is_tooltip_dismissed=!0})}}},{key:"getGroupsToLoad",value:function(){return _toConsumableArray(b(".tcb-conditional-display-placeholder")).map(function(t){return t.getAttribute("data-group")})}},{key:"fetchGroups",value:function(){var i=this,t=this.getGroupsToLoad();0<t.length&&b.ajax({type:"get",xhrFields:{withCredentials:!0},url:tve_frontend_options.ajaxurl,dataType:"json",data:{action:"tcb_conditional_display",query_vars:tve_frontend_options.query_vars,query_strings:g.Utils.getQueryStrings(),post_variables:tve_frontend_options.$_POST,referrer:document.referrer,post_id:tve_frontend_options.post_id,groups:t}}).done(function(e){e.groups&&t.forEach(function(t){return i.processGroup(t,e.groups[t])}),e.footer_scripts&&(b(document.body).append(e.footer_scripts),setTimeout(function(){g.event_triggers(b("[data-display-group]"))})),e.external_resources&&i.loadExternalResources(e.external_resources),g.onDOMReady()})}},{key:"processGroup",value:function(t,e){var i=b('[data-group="'.concat(t,'"]'));void 0===e?i.remove():(i.replaceWith(e.content),b(".tve-cd-placeholder-css-".concat(t)).remove())}},{key:"loadExternalResources",value:function(t){var e=0<arguments.length&&void 0!==t?t:{js:[],css:[]};if(e.js)for(var i in e.js)if(e.js.hasOwnProperty(i)){var n="".concat(i,"-js");g.Utils.hasResource(n,e.js[i].url)||g.Utils.insertHeadScripts(e.js[i].url,n)}if(e.css)for(var o in e.css)if(e.css.hasOwnProperty(o)){var s="".concat(o,"-css");g.Utils.hasResource(s,e.css[o])||g.Utils.insertStylesheet(e.css[o],s)}}},{key:"bindEvents",value:function(){var o=this;b(".tve-conditions-text input").off("input").on("input",function(e){var t=b(e.currentTarget).parent(".tve-conditions-text"),i=t.data("set"),n=t.data("groups");i.forEach(function(t){t.is_checked=e.currentTarget.checked,t.is_unchecked=!e.currentTarget.checked}),n.forEach(function(t){var e=t.displays.find(function(t){return Array.isArray(t.sets)&&t.sets.some(function(t){return t.is_checked})});e=e||t.displays.find(function(t){return Array.isArray(t.sets)&&t.sets.some(function(t){return t.is_default})});var i=b('[data-display-group="'.concat(t.key,'"]'));parseInt(e.hide)?i.hide():(i.replaceWith(e.html),o.initFrontend())}),g.onDOMReady()});var i,n,s,a,r,d,l,e,c,p=b("#wp-admin-bar-tve-preview-conditions"),u=p.find("li:not(#wp-admin-bar-tve-conditions-tooltip)"),f=p.find("#wp-admin-bar-tve-preview-conditions-default"),v=p.find("#wp-admin-bar-tve-conditions-tooltip"),t=p.find(".tve-preview-conditions-close");function h(t){if(0<b(t.target).parents("#wp-admin-bar-tve-conditions-title").length){t.preventDefault();var e=i.getBoundingClientRect();n=e.top,s=e.left,a=l-e.height,r=d-e.width,document.addEventListener("mouseup",m),document.addEventListener("mousemove",y)}}function y(t){t.preventDefault(),n+=t.movementY,s+=t.movementX,n=_(e,a,n),s=_(c,r,s),i.style.top=n+"px",i.style.left=s+"px"}function m(){document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",y)}function _(t,e,i){return i<t?t:e<i?e:i}0<f.length&&(i=f[0],d=b(window).width(),l=b(window).height(),e=32,c=0,i.removeEventListener("mousedown",h),i.addEventListener("mousedown",h)),p.off("click").on("click",function(t){var e=b("#wpadminbar .conditional-tooltip-wrapper");b(t.target).is(".tve-preview-conditions-icon.admin-bar")&&(u.toggle(),p.toggleClass("conditional-draggable-box",u.is(":visible")),f.css({top:"",left:""}),v.hide(),tve_frontend_options.conditional_display.is_tooltip_dismissed||(e.toggle(),e.is(":visible")&&o.addPreviewList(e.find(".conditional-tooltip-preview-items"))))}),p.off("mouseenter").on("mouseenter",function(){tve_frontend_options.conditional_display.is_tooltip_dismissed&&!b("#wp-admin-bar-tve-conditions-wrapper").is(":visible")&&v.show()}),p.off("mouseleave").on("mouseleave",function(){v.hide()}),t.off("click").on("click",function(){var t=b("#wpadminbar .conditional-tooltip-wrapper");u.hide(),p.removeClass("conditional-draggable-box"),f.css({top:"",left:""}),tve_frontend_options.conditional_display.is_tooltip_dismissed||(t.show(),o.addPreviewList(t.find(".conditional-tooltip-preview-items")))})}},{key:"buildPreview",value:function(){var t=b("#wp-admin-bar-tve-preview-conditions");if(this.isPreviewNeeded()){t.removeClass("tcb-preview-hidden");var e=t.find("ul.ab-submenu"),i=e.find("#wp-admin-bar-tve-conditions-wrapper");i.length||(i=b('<li id="wp-admin-bar-tve-conditions-wrapper" data-styled-scrollbar="1"></li>'),e.append(i));var a=i.find(".tve-global-conditions"),n=i.find(".tve-unlinked-conditions"),r=a.find(".tve-conditions-list"),d=n.find(".tve-conditions-list");a.length||(a=b('<div class="tve-global-conditions ab-item ab-empty-item"><span class="tve-preview-conditions-subtitle">Global condition sets</span><hr><div class="tve-conditions-list"></div></div>'),r=a.find(".tve-conditions-list"),i.append(a),i.append('<div class="tve-global-conditions-divider"></div>')),n.length||(n=b('<div class="tve-unlinked-conditions ab-item ab-empty-item"><span class="tve-preview-conditions-subtitle">Unlinked conditions sets</span><hr><div class="tve-conditions-list"></div></div>'),d=n.find(".tve-conditions-list"),i.append(n)),r.empty(),d.empty(),tcb_condition_sets.forEach(function(s){s.displays.forEach(function(t){Array.isArray(t.sets)&&t.sets.forEach(function(t){var e=b('[data-display-group="'.concat(s.key,'"], [data-group="').concat(s.key,'"]')).length;if(t.is_global){var i=a.find('[data-global="'.concat(t.is_global,'"]'));if(i.length){var n=i.data("set"),o=i.data("groups");i.data("set",[t].concat(_toConsumableArray(n))).data("groups",[s].concat(_toConsumableArray(o)))}else r.append('<div class="tve-conditions-text" data-global="'.concat(t.is_global,'"><span class="tve-conditions-title">').concat(t.name,'</span><input type="checkbox" ').concat(t.is_checked?"checked":"","></div>")).toggleClass("tve-conditions-disabled",!e).find(".tve-conditions-text:last").data("set",[t]).data("groups",[s])}else t.is_default||d.append('<div class="tve-conditions-text"><span class="tve-conditions-title">'.concat(t.name,'</span><input type="checkbox" ').concat(t.is_checked&&e?"checked":"","></div>")).find(".tve-conditions-text:last").toggleClass("tve-conditions-disabled",!e).data("set",[t]).data("groups",[s])})})});var o=!0;[r,d].forEach(function(t){t.closest(".ab-item").toggleClass("hidden",0===t.children().length),o=o&&0!==t.children().length}),i.find(".tve-global-conditions-divider").toggleClass("hidden",!o),this.shouldHideIcon=!r.html().length&&!d.html().length||!i.find(".tve-conditions-text:not(.tve-conditions-disabled)").length,t.toggleClass("tcb-preview-hidden",this.shouldHideIcon),b("#wpadminbar").toggleClass("tcb-has-condition-preview",!this.shouldHideIcon)}}},{key:"isPreviewNeeded",value:function(){return"undefined"!=typeof tcb_condition_sets&&tcb_condition_sets.length}},{key:"addPreviewList",value:function(e){var n=[];tcb_condition_sets.forEach(function(i){return i.displays.forEach(function(t){var e=b('[data-display-group="'.concat(i.key,'"], [data-group="').concat(i.key,'"]')).length;Array.isArray(t.sets)&&t.sets.forEach(function(t){!t.is_checked||n.includes(t.name)&&t.is_global||!e||n.push(t.name)})})}),e.empty(),0<n.length?n.forEach(function(t){e.append("<li class='tve-preview-conditions-tooltip-display'>".concat(t,"</li>"))}):e.append("<li class='tve-preview-conditions-tooltip-display'>Default display</li>")}}]),t}());b(window).on("tcb_after_dom_ready",function(){tve_frontend_options.is_editor_page||t.initFrontend()}),TCB_Front.setModuleLoadedStatus("conditional-display",!0)}}(ThriveGlobal.$j,TCB_Front)}}}}}}})("workspace/editor/js/frontend/modules/conditional-display");